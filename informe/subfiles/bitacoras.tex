\documentclass[../informe_krapp.tex]{subfiles}
\begin{document}

\section{Bitacoras Personales}
\subsection{Krapp Ramiro}
\subsubsection{24/03/2022}
\begin{itemize}
	\item Comence creando un repositorio en github para subir todos los cambios del proyecto
	\item Cree un codigo en C++, para definir un sistema de clases.
	      La idea es hacer una clase Tren, para que sirva de blueprint para todos los trenes,
	      y una clase Persona, para que sea padre de otras dos clases, Maquinista y Pasajero.
	      Al pasajero le voy a asignar una sube, y al maquinista le voy a asignar
	      un salario y un seniority.
\end{itemize}
\subsubsection{25/03/2022}
\begin{itemize}
	\item Pienso implementar la sube con un sistema usando RFID\\
	      \small{\url{https://randomnerdtutorials.com/security-access-using-mfrc522-rfid-reader-with-arduino/}}
	\item La idea seria armar un sistema en el que cada usuario pueda tener un llavero
	      RFID, y que asigne ese llavero RFID con una cuenta.
	      Tambien necesito comprar los lectores para RFID.
	      En total, tengo pensado comprar 2 lectores y 4 llaveros RFID.
	      Por qué 2 lectores? Estaba pensando en asignar cada uno a una estación distinta.
	      Por qué 4 llaveros? Estaba pensando en asignar cada uno a un pasajero distinto.
	\item Encontre que para en \LaTeX \ dejar de tener problema con las url yendose fuera
	      pantalla, puedo usar el paquete url con la opcion [hyphens], lo
	      unico es que hay que cargar este paquete antes de hyperref.
	      Esto es porque por defecto el paquete hyperref ya carga al paquete url
	      \url{https://tex.stackexchange.com/questions/544671/option-clash-for-package-url-urlstyle}

\end{itemize}
\subsubsection{26/03/2022}
\begin{itemize}
	\item Encontre mucha documentacion del ESP32 y de proyectos con el RFID, la principal es esta:
	\item \url{https://arduinogetstarted.com/tutorials/arduino-rfid-nfc}
	\item \url{https://olddocs.zerynth.com/latest/official/board.zerynth.doit_esp32/docs/index.html}
	\item \url{https://testzdoc.zerynth.com/reference/boards/doit_esp32/docs/}
	\item \url{https://randomnerdtutorials.com/esp32-pinout-reference-gpios/}
	\item \url{https://randomnerdtutorials.com/getting-started-with-esp32/}
	\item Voy a usar el grafico de randomnerdtutorials, del link de getting-started...,
	      el que incluye que pines son GPIO, me va a servir un montón.
	      Para cuando quiera programar, solamente tengo que recordar que lo mejor es usar los
	      GPIO del 13 al 33, y que mi DOIT ESP32 DevKit V1 es la version de 30 pines
	\item Decidi seguir el tutorial de este link
	      \url{https://www.instructables.com/ESP32-With-RFID-Access-Control/}
	\item Hice andar el codigo durante un tiempo, grabe que funcionaba incluso, pero de
	      repente dejo de funcionar, solamente me da un error:
	      PCD\_Authenticate() failed: Timeout in communication.
	\item Creo que se por qué dejó de funcionar, me parece que cortocircuité algo
	      con el la parte de metal del llavero, me parece haber cortocircuitado
	      los pines del lector RFID-RC552
\end{itemize}

\subsubsection{27/03/2022}
\begin{itemize}
	\item Hice una branch nueva en git para trabajar exclusivamente en el informe,
	      la llamé update\_informe.
	      Aproveché para eliminar la sección Base de Datos, que me había quedado ahí
	      de un copypaste de un proyecto anterior.
\end{itemize}

\subsubsection{28/03/2022}
\begin{itemize}
	\item Cometi un error haciendo un stash en git y elimine parte del trabajo que hice
	      en el informe :'(
	\item Encontre este codigo que me puede servir

	      \url{https://esp32io.com/tutorials/esp32-rfid-nfc}
	\item Tambien encontre la documentacion de la libreria para los RFID que usa el
	      protocolo de comunicacion MFRC, pero como usa SPI no se como meter varios RFID en
	      paralelo sin usar RFID, lo tendria que investigar
	      \url{https://www.arduino.cc/reference/en/libraries/mfrc522/}
\end{itemize}

\subsubsection{29/03/2022}
\begin{itemize}
	\item Investigando info para hacer el informe y saber más sobre SPI, encontre esto:
	      \begin{itemize}
		      \item \url{https://www.arduino.cc/en/reference/SPI}
		      \item \url{https://arduinogetstarted.com/faq/how-to-connect-multiple-spi-sensors-devices-with-arduino} (Especialmente útil para conectar multiples dispositivos)
		      \item \url{https://arduinogetstarted.com/tutorials/arduino-rfid-nfc}
		      \item \url{https://www.exostivlabs.com/files/documents/Introduction-to-I2C-and-SPI-Protocols.pdf?/article/aa-00255/22/introduction-to-spi-and-ic-protocols.html}
		      \item \url{https://www.corelis.com/education/tutorials/spi-tutorial/}
		      \item \url{https://learn.sparkfun.com/tutorials/serial-peripheral-interface-spi/}
	      \end{itemize}
	\item Creo que para lo que quiero hacer me sirve la conexion daisy-chained
	      del protocolo SPI
	\item Para las bibliografias, voy a usar esto \url{https://latex-tutorial.com/tutorials/bibtex/}
	\item también este tutorial sirve \url{https://www.overleaf.com/learn/latex/Bibliography_management_with_biblatex}
	\item Estuve trabajando en el informe, hice gran parte de la sección del SPI

\end{itemize}
\subsubsection{30/03/2022}
\begin{itemize}
	\item Hoy estoy trabajando en la documentacion del sistema RFID, mientras espero
	      que lleguen los componentes que compré. Estoy haciendo la documentación porque
	      me sirve para estudiar y ya entrar a armar cosas con más conocimiento.
	\item Cambie de proyecto, voy a hacer un sistema de seguridad para empresas.
	      Lo hice porque no me coordinaba con los contenidos de la materia
	      Empleo Local y Desarrollo Productivo.

	      La voy a llamar Librepass
\end{itemize}

\subsubsection{31/03/2022}
\begin{itemize}
	\item Hoy estuve haciendo pruebas, logre hacer andar el lector usando la tarjeta,
	      incluso pareciera como si la tarjeta leyera más rápido. Estuve usando el
	      código que saqué de instructables.
	      Yo pensé que había quemado el lector, pero me parece que lo que
	      dejó de andar es el tag RFID, desconozco exactamente el por qué, sospecho
	      que dejó de funcionar cuando quise leer/escribir en otros bloques
	      que no sean el 1. Desconozco también el por qué esto arruinaría el tag.
	\item Encontre una nueva version de la libreria MFRC522, que soporta I2C
	      \url{https://github.com/OSSLibraries/Arduino_MFRC522v2}
	\item Esa libreria no me detecta mi lector, probe con el ejemplo CheckFirmware y
	      DumpInfo, y segun CheckFirmware, no todos los hardwares son soportados
	\item Probe con la version original de la libreria, y tampoco me detecta mi lector
\end{itemize}

\subsubsection{01/04/2022}
\begin{itemize}
	\item Creo que se por que no funcionaba, la version nueva de la libreria funciona
	      con ciertos sensores, y no estoy del todo seguro de por qué.

	      Ademas, los ejemplos que habia en la documentacion de la nueva no funcionaban en ningun
	      caso, no estoy seguro de por qué.

	      Estoy pensando de mantener el pinout de la version que me funciona, y modificar
	      el pinout del codigo de la version v2, pero no creo que me sirva para demasiado, si
	      total la version original ya me funciona para todo lo que quiero hacer.

	      Mucho más que leer la UID no necesito para este sistema. Por qué no guardo la info
	      de usuario en la propia tarjeta? Porque es una idea estúpida, es muy facil
	      clonar cualquiera de estas tarjetas, entonces lo que tengo que hacer es un sistema de
	      usuarios y contraseñas. Deberia de ver si hay alguna forma de no guardar la contraseña
	      en plaintext, seguro que hay alguna forma, siempre hay una forma.

	\item Estaba teniendo un problema con la declaración de la clase Empleado,
	      por alguna razón todos los setters que seteaban Strings no funcionaban. La razón?
	      Me confundí al hacer un copypaste, y llame a todos los setters
	      de la misma forma, void setName() {...}

	\item Al final voy a usar SPI, no pude hacer andar la libreria para que funcione
	      con I2C. Igual al final es mejor, llego a poder experimentar con SPI.
	      En cierta forma me conviene, porque SPI es rapidisimo, y la realidad es que nadie
	      quere estar mas de 1 segundo apoyando la tarjeta para que se la lea.

	\item Del informe me queda pendiente hacer la seccion del ESP32 de partes-proyecto, hablar un poco
	      de las ventajas y desventajas de SPI, y unas cosas más.

	      Pero ahora me voy a poner a programar, quiero diseccionar el
	      codigo que saqué de un tutorial de instructables.

	\item En muchas partes se habla del PICC, significa
	      Proximity Integrated Circuit Card, es el chip que esta adentro del tag RFID.

	\item Tambien, PCD significa proximity coupling device.

	\item Voy a eliminar la funcion writingData(), no me sirve para nada, ya que
	      me voy a manejar todo por el sistema microcontrolado

	\item Me puse a curiosear (de vuelta) con la version v2 de la libreria
	      MFRC522v2, (que necesita que incluyas wire)
	      y lo hice andar. Nomas tuve que copiar el pinout que aparece en este github
	      \url{https://github.com/OSSLibraries/Arduino_MFRC522v2}, pero con RST en el
	      pin 22, y puse SPI SS (o sea, SDA) en el pin 21. Deberia ver que pasa si
	      lo conecto como aparece en el github, pero por ahora,
	      \textbf{El dumpinfo está andando}.

	\item Ahi lo probé con el pinout como el github,
	      y anda jajajaja, que locuras de la vida,
	      es la primera vez que un circuito que armo a las 20:55 funciona,
	      por lo general es al revés, me voy a dormir con los circuitos que no funcionan.

	\item Bueno, creo que lo decidí, me voy a pasar a la version v2 de la libreria,
	      es más nueva y tiene soporte, no como la otra que está abandonada y solamente
	      acepta pull requests para corregir typos.

	\item La razon por la que antes no andaba es muy sencilla, creo que solamente
	      conectado un pin, el de SS. O sea, cuando lo armé me parecía muy raro que en código
	      solamente especificara un solo pin, pero como estaba muy quemado pensé que capaz
	      solamente usaba un pin. No tuvo ningun sentido la verdad, son cosas de estar muy
	      quemado de la cabeza



\end{itemize}
\subsubsection{02/04/2022}
\begin{itemize}
	\item Me puse a testear los codigos de ejemplo del MFRC522v2, parece que el
	      CheckFirmware anda bien ahora que lo conecté bien
	\item Este issue de github me puede guiar a usar multiples lectores RFID
	\item La carpeta doc de la libreria MFRC522 me tira documentación muy util
	\item \url{https://github.com/OSSLibraries/Arduino_MFRC522v2/tree/master/doc}
	\item De todas formas, voy a seguir trabajando con la librería original, por lo menos
	      por ahora
	\item Me puse a leer el codigo fuente de la libreria original, y creo que entiendo por
	      qué el autor la abandonadó, es un caos, escasean los comentarios
	      y no hay documentación del propósito de cada función.
	\item Implemente una función para leer el UID, creo que no necesito mucho más.

	\item Encontre una libreria para poder hacer logging, en vez de Serialprintear a
	      lo imbecil. \url{https://github.com/thijse/Arduino-Log/}

	\item Acabo de hacer una estupidez. Quise sujetar el ESP32 en el protoboard,
	      para que no esté dando vueltas en el aire, con todos los cables dupont.
	      Como no podia meterlo porque tenía cables en un lado, se me ocurrió la
	      maravillosa idea de sujetarlo usando el carril de VCC del protoboard.

	      En el momento, me dije a mí mismo `` No va a pasar nada, si no tengo nada
	      conectado en el carril de VCC''.

	      Momentos despues, se apagó el LED del ESP32, y me dí cuenta de mí error,
	      acababa de cortocircuitar los primeros pines de la fila izquierda,
	      acababa de cortocircuitar VIN y GND, quemando así el ESP32.

	      Es un sábado a las 8 de la noche, y aora me quedé sin que programar el domingo.
	      Encima voy a tener que comprar uno nuevo, y estan como 1300 pesos.

	      Tambien tengo la opcion de ver que es lo que se quemó, pudo haber sido
	      el regulador de tensión AMS 1117.

	\item Me puse a buscar en internet, y no soy el primer imbecil que cortocircuitó
	      esos dos pines. Parece que hay una solución, y es alimentarlo de forma externa
	      desde VIN, porque lo que deja de funcionar cuando haces lo que yo hice
	      es la alimentación desde cable USB.

	\item Lo hice andar con alimentación externa
\end{itemize}

\subsubsection{04/04/2022}
\begin{itemize}
	\item Eventualmente voy a tener que usar FreeRTOS, para usar multiples tasks
	      \url{https://randomnerdtutorials.com/esp32-dual-core-arduino-ide/}
	\item Anduve probando de hacer la lista de empleados con un vector en vez
	      de un array, pero se ve más complejo de usar. Eso no es un problema, pero preferiría
	      dejarlo para el final. Tambien buscando cosas, encontre esta libreria
	      \url{https://github.com/janelia-arduino/Vector}, tendría que comparar que ventajas
	      tiene con respecto a
	      \url{https://github.com/mike-matera/ArduinoSTL?utm_source=platformio&utm_medium=piohome},
	      que es un port de la C++ standard library.
	\item Tuve problemas creando un array de la clase Empleado, me tiraba errores
	      con el constructor, y lo solucioné haciendo sobrecarga de constructores, hice
	      un constructor con parametros, y otro sín parámetros.
	      Tambien para mantener una cuenta de los empleados, hice una variable static
	      en la clase Empleado, llamada cuentaEmpleados, que se modifica en los constructores
	      y destructores.
	\item Estuve trabajando hasta las 9:30PM en una placa preperforada
	      para no tener que estar con el protoboard, que tiene una calidad deplorable,
	      y tener todo bien organizado. \todo{adjuntar imagen}
\end{itemize}

\subsubsection{07/04/2022}
\begin{itemize}
	\item Agregue la licencia al informe, ahora me voy a poner a trabajar en la documentacion
	      del ESP32
	\item Hice una branch nueva en git, para poder trabajar en esta librería.
	      \url{https://github.com/esphome/ESPAsyncWebServer}. La idea sería usar esta
	      librería para poder hacer la configuración
\end{itemize}

\subsubsection{08/04/2022}
\begin{itemize}
	\item No me anda el constructor, no llegan los parametros.
	      Para mi tiene que ver con el hecho de que estoy teniendo un constructor vacío para
	      que ande el array, voy a probar a laburar sin el array a ver que es lo que pasa.
	\item Sino lo que se me ocurrió es abandonar el constructor y pasarme a
	      usar los setters directamente
	\item Me acabo de fijar, me parece que lo que no anda no es el constructor,
	      sino la libreria de logging, no me aparecen las variables
	\item Ya se por qué no andaba, me olvidé de leer la documentación.
	      Log.info() funciona como printf, hay que declarar el formato
	      de la misma forma que printf lo hace.
	      Entonces, me habia olvidado de los \%s.
	      Tambien, dentro del Log.info("cosas a printear" CR), CR significa "\textbackslash n"
	\item Hice un merge de la branch dev-webserver hacia la branch dev
\end{itemize}

\subsubsection{16/04/2022}
\begin{itemize}
	\item Hace un tiempo que no trabajaba en el proyecto y ya me estaba poniendo nervioso,
	      asi que hoy me puse a trabajar en el tema webserver.
	      Para ello, me guié de estas páginas:
	      \begin{itemize}
		      \item \url{https://randomnerdtutorials.com/esp32-dht11-dht22-temperature-humidity-web-server-arduino-ide/}
		      \item \url{https://www.w3schools.com/XML/ajax_xmlhttprequest_response.asp}
		      \item \url{https://techtutorialsx.com/2018/07/23/esp32-arduino-http-server-template-processing-with-multiple-placeholders/}
	      \end{itemize}

	\item En base a esto, logre hacer una pagina web que muestre dos valores,
	      humedad y temperatura (ambos conseguidos usando String(random())) y que se
	      actualizen cada 10 segundos \textbf{sin tener que recargar la página.}.
	      Por lo tanto, puedo decir que conseguí un webserver que funciona usando AJAX.

	      Lo que habría que hacer es que ande con valores de verdad, como la UID
	      de la tarjeta, y que funcione con eventos, y no intervalos.

	\item Leyendo un poco más de la documentacion de ESPAsyncWebServer, me doy
	      cuenta que los eventos los tendría que armar en c++, y no en el JavaScript
	      del documento HTML. De todas formas, parece haber un plugin para eventos,
	      \url{https://github.com/me-no-dev/ESPAsyncWebServer#async-event-source-plugin}

	\item Para ir practicando un poco el tema del AJAX, voy a probar poniendo
	      un <p> en la página que me tire la hora. Me voy a ayudar de esta guía
	      \url{https://randomnerdtutorials.com/esp32-date-time-ntp-client-server-arduino/}

	\item Antes de que me olvide, me lo voy a anotar, porque no es la primera vez
	      que cometo este error: processor se llama cuando te conectas a la pagina web,
	      y el JavaScript se llama con los intervals, son dos cosas separadas

	\item Una nueva cosa en la lista de errores estupidos, haciendo el codigo de la hora,
	      al copypastear parte de sistema de intervals en JavaScript, me olvide de cambiar el valor de getElementById("humedad") por getElementById("hora"), y eso
	      hacía que:
	      \begin{enumerate}
		      \item Hora se quedara en ``Consiguiendo hora...''
		      \item humidity se seteara en 16, y cada vez que la humedad se queria actualizar,
		            tiraba un pequeño flash del otro valor, para inmediatamente cambiar
		            al valor de getHour(). Fue por esto que me di cuenta de que el
		            problema era el valor que puse en getElementById()
	      \end{enumerate}
	\item Está el codigo de la hora terminado
\end{itemize}

\subsubsection{17/04/2022}
\begin{itemize}
	\item Agregue comentarios a todas las funciones, y ordene un poco el código
\end{itemize}

\subsubsection{18/04/2022}
\begin{itemize}
	\item Estuve trabajando en el informe, actualize toda la seccion del ESP32, agregando
	      la tabla de pines, y las figuras para la version de 30 GPIO y 36 GPIO
\end{itemize}

\subsubsection{19/04/2022}
\begin{itemize}
	\item Estuve trabajando nuevamente en el informe, agregue informacion sobre el framework
	      arduino
\end{itemize}

\subsubsection{21/04/2022}
\begin{itemize}
	\item Para usar eventos en el webserver, voy a seguir esta guia:
	      \url{https://randomnerdtutorials.com/esp32-web-server-sent-events-sse/}
\end{itemize}

\subsubsection{28/04/2022}
\begin{itemize}
	\item Tengo andando los eventos, ahora cuando acerco la tarjeta RFID me muestra
	      la UID en la página web.
	\item Para enviar info desde el cliente hacia el servidor, pense usar esto:
	      \url{https://randomnerdtutorials.com/esp32-esp8266-input-data-html-form/}
	\item Al final, estuve probando en hacerlo sin usar forms, pero
	      tengo que ver como enviar la informacion al servidor con un
	      xmlhttprequest, esta página tiene buenos tutoriales
	      \url{https://www.w3schools.com/xml/ajax_intro.asp}
\end{itemize}

\subsubsection{16/05/2022}
\begin{itemize}
	\item Puedo usar el status code 204 de HTTP, para usar forms
\end{itemize}

\subsubsection{19/05/2022}
\begin{itemize}
	\item Dividí el codigo en multiples archivos usando headers.
	      Hice un header llamado krapp_utils, en el que metí todas mis funciones.
	\item Había tenido un problema con la compilacion, y el error estaba en que había metido
	      tanto los archivos .h como los .cpp en el directorio include/, y esto no es
	      la forma correcta. La forma correcta es meter los archivos .h en el include/. y
	      los archivos .cpp en el src/.
	\item Más adelante tengo pensado hacer un archivo para la clase Empleado
\end{itemize}

\end{document}



